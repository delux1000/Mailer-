<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Cash Mailer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #4e54c8;
            --secondary-color: #8f94fb;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .card {
            border-radius: 20px;
            border: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .card-header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border-bottom: none;
            padding: 2rem;
            text-align: center;
        }
        
        .card-body {
            padding: 2.5rem;
        }
        
        .form-control, .form-control:focus {
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            padding: 0.75rem 1rem;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(78, 84, 200, 0.25);
        }
        
        .btn-send {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s;
            width: 100%;
            margin-top: 1rem;
        }
        
        .btn-send:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(to right, #fff, #f8f9fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .alert-custom {
            border-radius: 10px;
            border: none;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .recipient-list {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .recipient-item {
            background: #f8f9fa;
            padding: 0.3rem 0.6rem;
            margin: 0.2rem;
            border-radius: 5px;
            display: inline-block;
            font-size: 0.9rem;
        }
        
        .status-icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        
        .progress {
            height: 8px;
            border-radius: 4px;
            margin: 1.5rem 0;
        }
        
        .info-box {
            background: #f8f9fa;
            border-left: 4px solid var(--primary-color);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10">
                <div class="card">
                    <div class="card-header">
                        <div class="logo">üí∞ Super Cash Mailer</div>
                        <p class="mb-0">International Earn Platform Email Sender</p>
                    </div>
                    
                    <div class="card-body">
                        <!-- Success/Error Messages -->
                        <div id="alertContainer"></div>
                        
                        <!-- Info Box -->
                        <div class="info-box">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Important:</strong> Use Gmail App Password (not regular password) for authentication. 
                            <a href="https://support.google.com/accounts/answer/185833" target="_blank" class="ms-1">Learn how to create one</a>
                        </div>
                        
                        <!-- Email Form -->
                        <form id="emailForm">
                            <!-- Gmail Credentials -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="gmail_email" class="form-label">Gmail Address</label>
                                    <input type="email" class="form-control" id="gmail_email" 
                                           placeholder="your.email@gmail.com" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="gmail_password" class="form-label">Gmail App Password</label>
                                    <input type="password" class="form-control" id="gmail_password" 
                                           placeholder="16-character app password" required>
                                </div>
                            </div>
                            
                            <!-- Sender Details -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="header_name" class="form-label">Sender Name</label>
                                    <input type="text" class="form-control" id="header_name" 
                                           placeholder="Super Cash International" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="subject" class="form-label">Email Subject</label>
                                    <input type="text" class="form-control" id="subject" 
                                           placeholder="Exciting Opportunity!" required>
                                </div>
                            </div>
                            
                            <!-- Recipients -->
                            <div class="mb-3">
                                <label for="recipients" class="form-label">Recipient Emails</label>
                                <textarea class="form-control" id="recipients" rows="3" 
                                          placeholder="Enter email addresses separated by commas" required></textarea>
                                <small class="text-muted">Example: user1@example.com, user2@example.com</small>
                                <div id="recipientPreview" class="recipient-list" style="display: none;">
                                    <div id="recipientCount" class="mb-2"></div>
                                    <div id="recipientTags"></div>
                                </div>
                            </div>
                            
                            <!-- Message Body -->
                            <div class="mb-4">
                                <label for="message_body" class="form-label">Email Message</label>
                                <textarea class="form-control" id="message_body" rows="6" required></textarea>
                            </div>
                            
                            <!-- Progress Bar -->
                            <div class="progress" style="display: none;" id="progressBar">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                     role="progressbar" style="width: 0%"></div>
                            </div>
                            
                            <!-- Send Button -->
                            <button type="submit" class="btn btn-send" id="sendButton">
                                <i class="bi bi-send me-2"></i> Send Emails
                            </button>
                            
                            <!-- Results Section -->
                            <div id="resultsContainer" class="mt-4" style="display: none;">
                                <h5>Results:</h5>
                                <div id="resultsList"></div>
                            </div>
                        </form>
                    </div>
                    
                    <div class="card-footer text-muted text-center">
                        <small>¬© 2024 Super Cash International Earn Platform</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('emailForm');
            const recipientsTextarea = document.getElementById('recipients');
            const recipientPreview = document.getElementById('recipientPreview');
            const recipientTags = document.getElementById('recipientTags');
            const recipientCount = document.getElementById('recipientCount');
            const progressBar = document.getElementById('progressBar');
            const resultsContainer = document.getElementById('resultsContainer');
            const resultsList = document.getElementById('resultsList');
            const alertContainer = document.getElementById('alertContainer');
            const sendButton = document.getElementById('sendButton');
            
            // Update recipient preview
            recipientsTextarea.addEventListener('input', function() {
                const emails = this.value.split(',').map(e => e.trim()).filter(e => e);
                
                if (emails.length > 0) {
                    recipientPreview.style.display = 'block';
                    recipientCount.textContent = `Total recipients: ${emails.length}`;
                    
                    recipientTags.innerHTML = '';
                    emails.forEach(email => {
                        const tag = document.createElement('span');
                        tag.className = 'recipient-item';
                        tag.textContent = email;
                        recipientTags.appendChild(tag);
                    });
                } else {
                    recipientPreview.style.display = 'none';
                }
            });
            
            // Form submission
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Disable send button
                sendButton.disabled = true;
                sendButton.innerHTML = '<i class="bi bi-hourglass-split me-2"></i> Sending...';
                
                // Show progress bar
                progressBar.style.display = 'block';
                updateProgress(0);
                
                // Clear previous results and alerts
                resultsContainer.style.display = 'none';
                resultsList.innerHTML = '';
                clearAlerts();
                
                // Get form data
                const formData = {
                    gmail_email: document.getElementById('gmail_email').value,
                    gmail_password: document.getElementById('gmail_password').value,
                    header_name: document.getElementById('header_name').value,
                    subject: document.getElementById('subject').value,
                    message_body: document.getElementById('message_body').value,
                    recipients: document.getElementById('recipients').value
                };
                
                try {
                    const response = await fetch('/send-email', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        showAlert('success', 'üéâ All emails sent successfully!');
                        
                        // Display results
                        resultsContainer.style.display = 'block';
                        result.results.forEach((item, index) => {
                            const resultItem = document.createElement('div');
                            resultItem.className = `alert ${item.success ? 'alert-success' : 'alert-danger'} alert-custom`;
                            
                            const icon = item.success ? 
                                '<i class="bi bi-check-circle-fill status-icon"></i>' : 
                                '<i class="bi bi-x-circle-fill status-icon"></i>';
                            
                            const status = item.success ? 
                                `<span class="badge bg-success">Success</span>` : 
                                `<span class="badge bg-danger">Failed</span>`;
                            
                            const message = item.success ? 
                                `Message ID: ${item.messageId}` : 
                                `Error: ${item.error}`;
                            
                            resultItem.innerHTML = `
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        ${icon}
                                        <strong>${item.recipient}</strong>
                                    </div>
                                    ${status}
                                </div>
                                <div class="mt-2">${message}</div>
                            `;
                            
                            resultsList.appendChild(resultItem);
                            
                            // Update progress bar
                            updateProgress(((index + 1) / result.results.length) * 100);
                        });
                    } else {
                        showAlert('danger', `‚ùå Error: ${result.message || 'Failed to send emails'}`);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showAlert('danger', `‚ùå Connection error: ${error.message}`);
                } finally {
                    // Reset button and progress bar
                    sendButton.disabled = false;
                    sendButton.innerHTML = '<i class="bi bi-send me-2"></i> Send Emails';
                    progressBar.style.display = 'none';
                }
            });
            
            // Helper functions
            function updateProgress(percentage) {
                const progressBarElement = document.querySelector('.progress-bar');
                progressBarElement.style.width = `${percentage}%`;
                progressBarElement.textContent = `${Math.round(percentage)}%`;
            }
            
            function showAlert(type, message) {
                clearAlerts();
                
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type} alert-custom alert-dismissible fade show`;
                alertDiv.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                
                alertContainer.appendChild(alertDiv);
            }
            
            function clearAlerts() {
                alertContainer.innerHTML = '';
            }
            
            // Pre-fill form with sample data for testing (remove in production)
            document.getElementById('header_name').value = 'Super Cash International';
            document.getElementById('subject').value = 'Exciting Earning Opportunity!';
            document.getElementById('message_body').value = `Dear Recipient,

We are excited to inform you about our new earning platform - Super Cash International!

Key Features:
‚Ä¢ Daily earning opportunities
‚Ä¢ Low minimum payout
‚Ä¢ 24/7 support
‚Ä¢ Secure platform

Join us today and start earning!

Best regards,
Super Cash Team`;
        });
    </script>
</body>
</html>
